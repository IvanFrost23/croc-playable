var keypadBlocked=!1,gridData=[[["A","C","T"],["C","U","T"]],[["C","U","E"],["A","C","E"]],[["F","A","T"],["E","A","T"]],[["T","E","A"],["C","A","T"]],[["C","U","T","E"],["C","A","F","E"]],[["F","E","A","T"],["F","A","C","T"]],[["F","A","C","E"],["F","A","T","E"]],[["F","A","C","E","T"],["A","C","U","T","E"]]],correctWords=["ACT","CUT","CUE","ACE","FAT","EAT","TEA","CAT","CUTE","CAFE","FEAT","FACT","FACE","FATE","FACET","ACUTE"],availableLetters=["E","T","F","A","C","U"],typedWord="",coinCountElement=document.getElementById("coin-count"),coinCount=parseInt(coinCountElement.textContent,10),grid=document.getElementById("grid"),typedWordElement=document.getElementById("typed-word"),keypad=document.querySelector(".keypad"),canvas=document.getElementById("keypad-canvas"),ctx=canvas.getContext("2d"),gameContainer=document.getElementById("game-container"),moves=0;function initGrid(){gridData.forEach(function(e,o){e.forEach(function(e,d){var r=document.createElement("div");r.classList.add("word"),e.forEach(function(e,t){var n=document.createElement("div");n.classList.add("cell"),n.dataset.row=o,n.dataset.word=d,0===(n.dataset.index=t)&&(n.innerHTML="<span>"+e+"</span>",n.classList.add("green")),r.appendChild(n)}),grid.appendChild(r)})})}canvas.width=300;var dragTimer,isDragging=!(canvas.height=300),draggedWord="",letterPositions={},draggedLetters=[],clickedLetters=[];function initLetters(){var a=2*Math.PI/availableLetters.length;availableLetters.forEach(function(t,e){var n=document.createElement("div");n.classList.add("letter"),n.textContent=t,n.dataset.letter=t;var d=e*a-Math.PI/2,r=120*Math.cos(d)+150-35,o=120*Math.sin(d)+150-35;n.style.left=r+"px",n.style.top=o+"px",letterPositions[t]={x:r+35,y:o+35},n.addEventListener("mousedown",function(e){startDrag(t,e)}),n.addEventListener("touchstart",function(e){startDrag(t,e)}),n.addEventListener("mouseenter",function(e){dragOver(t,e)}),n.addEventListener("touchmove",function(e){var t=e.touches[0],n=document.elementFromPoint(t.clientX,t.clientY);n&&n.classList.contains("letter")&&dragOver(n.dataset.letter,e)}),keypad.appendChild(n)}),document.addEventListener("mouseup",endDrag),document.addEventListener("touchend",endDrag)}function startDrag(e){checkMoves(),keypadBlocked||(isDragging=!0,draggedWord=e,typedWordElement.textContent=draggedWord,draggedLetters=[e],moves++,updateTypedWordDisplay())}function checkMoves(){4<=moves&&(alert("GAME OVER!"),keypadBlocked=!0)}function updateTypedWordDisplay(){var d=document.getElementById("typed-word");d.innerHTML="",draggedWord.split("").forEach(function(e,t){var n=document.createElement("div");n.classList.add("typed-cell"),n.innerHTML="<span>"+e+"</span>",t===draggedWord.length-1&&(n.classList.add("appear"),setTimeout(function(){n.classList.remove("appear")},300)),d.appendChild(n)})}function dragOver(e){isDragging&&-1===draggedLetters.indexOf(e)&&(draggedLetters.push(e),draggedWord+=e,updateTypedWordDisplay(),drawLine(draggedLetters))}function endDrag(){isDragging&&(isDragging=!1,typedWord=draggedWord,checkWord(),draggedWord="",draggedLetters=[],clearLines())}function drawLine(e){if(clearLines(),!(e.length<1)){e.forEach(function(e){var t=letterPositions[e];t&&(ctx.beginPath(),ctx.arc(t.x,t.y,30,0,2*Math.PI),ctx.fillStyle="rgba(140, 50, 187, 0.8)",ctx.fill())});for(var t=0;t<e.length-1;t++){var n=letterPositions[e[t]],d=letterPositions[e[t+1]];n&&d&&(ctx.beginPath(),ctx.moveTo(n.x,n.y),ctx.lineTo(d.x,d.y),ctx.strokeStyle="rgba(140, 50, 187, 0.8)",ctx.lineWidth=15,ctx.stroke())}}}function clearLines(){ctx.clearRect(0,0,canvas.width,canvas.height)}function addCoins(e){coinCount+=e;var t=document.createElement("div");t.textContent="+"+e,t.classList.add("coin-delta");var n=coinCountElement.getBoundingClientRect();t.style.left=n.left+10+"px",t.style.top=n.bottom+10+"px",document.body.appendChild(t),setTimeout(function(){t.style.transform="translateY(-50px)",t.style.opacity="0"},10),coinCountElement.textContent=coinCount,setTimeout(function(){t.remove()},1e3)}var guessedWords=new Set;function checkWord(){var e=document.getElementById("typed-word");if(guessedWords.has(typedWord))resetTypedWord();else if(-1!==correctWords.indexOf(typedWord))guessedWords.add(typedWord),keypadBlocked=!0,addCoins(10),setTimeout(function(){for(var e=Array.from(document.querySelectorAll(".grid .cell")),t=0,n=0;n<correctWords.length&&correctWords[n]!==typedWord;n++)t+=correctWords[n].length;animateCorrectWord(e.slice(t,t+typedWord.length))},300);else{var t=document.createElement("div");t.classList.add("cross"),e.appendChild(t),e.classList.add("shake"),setTimeout(function(){e.classList.remove("shake"),resetTypedWord()},500)}}function animateCorrectWord(m){var e=document.getElementById("typed-word");document.getElementById("game-container");Array.from(e.children).forEach(function(e,t){var n=m[t],d=document.getElementById("game-container"),r=getScaleFactor(d),o=e.getBoundingClientRect(),a=n.getBoundingClientRect(),i=d.getBoundingClientRect(),s=(o.left-i.left+window.scrollX)/r,c=(o.top-i.top+window.scrollY)/r,l=(a.left-i.left+window.scrollX)/r,g=(a.top-i.top+window.scrollY)/r,u=e.cloneNode(!0);u.style.position="absolute",u.style.left=s+"px",u.style.top=c+"px",u.style.transition="transform 0.5s ease, left 0.5s ease, top 0.5s ease",u.style.transitionDelay=.1*t+"s",d.appendChild(u),setTimeout(function(){u.style.left=l+"px",u.style.top=g-(0!==t?3:0)+"px",e.remove()},10),setTimeout(function(){u.remove(),n.innerHTML="<span>"+e.textContent+"</span>",keypadBlocked=!1,n.classList.add("green")},100*t+500)})}function getScaleFactor(e){var t=e.style.transform;if(!t)return 1;var n=t.match(/scale\(([^)]+)\)/);return n?parseFloat(n[1]):1}function resetTypedWord(){typedWord="",document.getElementById("typed-word").innerHTML="",clearLines(),clickedLetters=[]}function resizeGame(){var e,t=document.getElementById("game-container"),n=window.innerWidth,d=window.innerHeight;e=n/d<600/931?n/600:d/931,t.style.transform="scale("+e+")";var r=600*e,o=931*e;t.style.left=(n-r)/2+"px",t.style.top=(d-o)/2+"px"}initGrid(),initLetters(),window.addEventListener("resize",resizeGame),window.addEventListener("load",resizeGame);